######
# This file is autogenerated from https://github.com/integromat/mono/blob/master/libs/github-resources/src/repositories/vscode-apps-sdk.ts. Do not edit manually!!!
#
# More info at https://github.com/integromat/mono/blob/master/libs/github-resources/README.md#enable-release-please
######

name: Release Please
on:
  push:
    branches:
      - 'master'
  workflow_dispatch:

env:
  FORCE_COLOR: '1'

jobs:
  release-please:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      issues: write
      pull-requests: write
      contents: read
    env:
      NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
    steps:
      - name: Get Release app token
        id: get-release-app-token
        uses: actions/create-github-app-token@5d869da34e18e7287c1daad50e0b8ea0f506ce69 # v1.11.0
        with:
          private-key: ${{ secrets.RELEASE_APP_PEM }}
          app-id: ${{ vars.RELEASE_APP_ID }}

      - name: Setup Node.js
        uses: actions/setup-node@39370e3970a6d050c480ffad4ff0ed4d3fdee5af # v4.1.0
        with:
          registry-url: https://registry.npmjs.org
          node-version: '>=20.0'

      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

      - name: Run Release Please - tags
        env:
          GITHUB_TOKEN: ${{ steps.get-release-app-token.outputs.token }}
        run: |
          npx @integromat/actions-toolkit release-please --mode github-release

      - name: Run Release Please - PR
        env:
          GITHUB_TOKEN: ${{ steps.get-release-app-token.outputs.token }}
        run: |
          npx @integromat/actions-toolkit release-please --mode release-pr
